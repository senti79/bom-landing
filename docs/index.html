<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>bom-landing preview</title>
    <style>
      body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; line-height: 1.5; }
      header { margin-bottom: 16px; }
      pre { background: #f6f8fa; padding: 12px; border-radius: 6px; overflow: auto; }
      .hero { padding: 24px; border: 1px solid #e5e7eb; border-radius: 8px; margin-bottom: 16px; }
      .features { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
      .feature { border: 1px solid #e5e7eb; border-radius: 8px; padding: 12px; }
      .muted { color: #6b7280; }
    </style>
  </head>
  <body>
    <header>
      <h1>bom-landing JSON Preview</h1>
      <p class="muted">docs/content/landing.json을 불러와 간단히 렌더링합니다.</p>
    </header>

    <main id="app">
      <label>
        언어:
        <select id="lang">
          <option value="ko">한국어</option>
          <option value="en">English</option>
          <option value="ja">日本語</option>
          <option value="es">Español</option>
          <option value="zh">中文</option>
          <option value="de">Deutsch</option>
          <option value="fr">Français</option>
        </select>
      </label>
      <p id="status">로딩 중...</p>
    </main>

    <h3>Raw JSON</h3>
    <pre id="raw"></pre>

    <script>
      async function chooseAndLoad(lang) {
        const today = new Date().toISOString().slice(0,10);
        const base = './content';
        const manifestUrl = `${base}/manifest.json?v=${today}`;
        const status = document.getElementById('status');
        status.textContent = '로딩 중...';
        let data;
        try {
          const m = await fetch(manifestUrl, { cache: 'no-store' });
          if (m.ok) {
            const manifest = await m.json();
            const chosen = lang || manifest.defaultLang || 'ko';
            const path = manifest.languages?.[chosen];
            if (path) {
              const r = await fetch(`${base}/${path}?v=${today}`, { cache: 'no-store' });
              if (r.ok) data = await r.json();
            }
          }
        } catch (_) { /* ignore */ }
        if (!data) {
          // fallback to single file
          const url = `${base}/landing.json?v=${today}`;
          const res = await fetch(url, { cache: 'no-store' });
          if (!res.ok) throw new Error('Failed to load landing.json');
          data = await res.json();
        }

        // Render
        const app = document.getElementById('app');
        const sel = document.getElementById('lang');
        app.innerHTML = app.innerHTML.substring(0, app.innerHTML.indexOf('<p id="status"')) + '<p id="status"></p>';
        if (sel && lang) sel.value = lang;
        // Support two formats: field-style(HTML) OR sections-array
        if (data.heroTitleHtml || data.heroSubtitleHtml || data.demoHtml) {
          const hero = document.createElement('section');
          hero.className = 'hero';
          const h = document.createElement('h2');
          h.innerHTML = data.heroTitleHtml || '';
          const p = document.createElement('p');
          p.className = 'muted';
          p.innerHTML = data.heroSubtitleHtml || '';
          hero.appendChild(h);
          hero.appendChild(p);
          app.appendChild(hero);

          const demo = document.createElement('section');
          demo.innerHTML = data.demoHtml || '';
          app.appendChild(demo);

          const wrap = document.createElement('section');
          const ft = document.createElement('h3');
          ft.innerHTML = data.featuresTitleHtml || 'Features';
          wrap.appendChild(ft);
          const grid = document.createElement('div');
          grid.className = 'features';
          const features = [
            { t: data.feature1TitleHtml, d: data.feature1DescriptionHtml },
            { t: data.feature2TitleHtml, d: data.feature2DescriptionHtml },
            { t: data.feature3TitleHtml, d: data.feature3DescriptionHtml },
          ];
          for (const f of features) {
            if (!f.t && !f.d) continue;
            const card = document.createElement('div');
            card.className = 'feature';
            const tt = document.createElement('div');
            tt.innerHTML = f.t || '';
            const dd = document.createElement('div');
            dd.className = 'muted';
            dd.innerHTML = f.d || '';
            card.appendChild(tt);
            card.appendChild(dd);
            grid.appendChild(card);
          }
          wrap.appendChild(grid);
          app.appendChild(wrap);

          if (data.finalCtaTitleHtml) {
            const cta = document.createElement('h3');
            cta.innerHTML = data.finalCtaTitleHtml;
            app.appendChild(cta);
          }
        } else if (Array.isArray(data.sections)) {
          const title = document.createElement('h2');
          title.textContent = data.title || '제목 없음';
          app.appendChild(title);
          for (const section of data.sections) {
            if (section.type === 'hero') {
              const hero = document.createElement('section');
              hero.className = 'hero';
              const h = document.createElement('h3');
              h.textContent = section.headline || '헤드라인';
              const p = document.createElement('p');
              p.className = 'muted';
              p.textContent = section.sub || '';
              hero.appendChild(h);
              hero.appendChild(p);
              app.appendChild(hero);
            } else if (section.type === 'feature' && Array.isArray(section.items)) {
              const wrap = document.createElement('section');
              const h = document.createElement('h3');
              h.textContent = 'Features';
              wrap.appendChild(h);
              const grid = document.createElement('div');
              grid.className = 'features';
              for (const it of section.items) {
                const card = document.createElement('div');
                card.className = 'feature';
                const t = document.createElement('div');
                t.textContent = (it.icon ? it.icon + ' ' : '') + (it.title || '');
                const d = document.createElement('div');
                d.className = 'muted';
                d.textContent = it.desc || '';
                card.appendChild(t);
                card.appendChild(d);
                grid.appendChild(card);
              }
              wrap.appendChild(grid);
              app.appendChild(wrap);
            }
          }
        }

        document.getElementById('raw').textContent = JSON.stringify(data, null, 2);
        status.textContent = '';
      }
      const sel = document.getElementById('lang');
      sel.addEventListener('change', () => chooseAndLoad(sel.value).catch(err => { document.getElementById('status').textContent = '로드 실패: ' + err.message; }));
      chooseAndLoad('ko').catch(err => {
        document.getElementById('status').textContent = '로드 실패: ' + err.message;
      });
    </script>
  </body>
  </html>
